---
title: MLE + Hessian Computations
author: Stone Chen
date: '2020-06-30'
categories: []
tags: []
---



<div id="mle-and-hessian-computations" class="section level1">
<h1>mle and hessian computations</h1>
</div>
<div id="a-formula-for-the-determinant-of-a-compound-symmetric-covariance-matrix" class="section level1">
<h1>A formula for the determinant of a compound symmetric covariance matrix</h1>
<p><span class="math display">\[\begin{aligned}
\Sigma&amp;=\left|\begin{array}{cccc}
\sigma_{11}^{2} &amp; \rho \sigma_{1} \sigma_{2} &amp; \cdots &amp; \rho \sigma_{1} \sigma_{p} \\
\rho \sigma_{2} \sigma_{1} &amp; \sigma_{22}^{2} &amp; \cdots &amp; \rho \sigma_{2} \sigma_{p} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho \sigma_{p} \sigma_{1} &amp; \cdots &amp; \cdots &amp; \sigma_{p p}^{2}
\end{array}\right|\\
&amp;=\left|\begin{array}{ccccc}
1 &amp; \sigma_{1} &amp; \sigma_{2} &amp; \cdots &amp; \sigma_{p} \\
0 &amp; \sigma_{11}^{2} &amp; \rho \sigma_{1} \sigma_{2} &amp; \cdots &amp; \rho \sigma_{1} \sigma_{p} \\
0 &amp; \rho \sigma_{2} \sigma_{1} &amp; \sigma_{22}^{2} &amp; \cdots &amp; \rho \sigma_{2} \sigma_{p} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; \rho \sigma_{p} \sigma_{1} &amp; \cdots &amp; \cdots &amp; \sigma_{p p}^{2}
\end{array}\right|\\
&amp;=\left|\begin{array}{ccccc}
1 &amp; \sigma_{1} &amp; \sigma_{2} &amp; \cdots &amp; \sigma_{p} \\
-\rho \sigma_{1} &amp; \sigma_{11}^{2}(1-\rho) &amp; 0 &amp; \cdots &amp; 0 \\
-\rho \sigma_{2} &amp; 0 &amp; \sigma_{22}^{2}(1-\rho) &amp; 0 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
-\rho \sigma_{p} &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{p p}^{2}
\end{array}\right|\\
&amp;=\left| \begin{array}{ccccc}
1+\sum_{i=1}^{p} \frac{\rho}{(1-\rho)} &amp;\sigma_{1} &amp; \sigma_{2} &amp; \cdots &amp; \sigma_{p} \\
0 &amp; \sigma_{11}^{2}(1-\rho) &amp; 0 &amp; \cdots &amp; 0 \\
0 &amp; 0 &amp; \sigma_{22}^{2}(1-\rho) &amp; 0 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \sigma_{p p}^{2}
\end{array}\right|\\
&amp;=\left(1+\sum_{i=1}^{p} \frac{\rho}{(1-\rho)}\right)\left((1-\rho)^{p} \prod_{i=1}^{p} \sigma_{i i}^{2}\right)
\end{aligned}\]</span></p>
<div id="steps" class="section level2">
<h2>Steps</h2>
<p>The goal is to put the matrix into an upper triangular format. That way we can directly read off the determinant value.</p>
<p>We add an additional row and column (does not change determinant)</p>
<p>Multiply new first row by <span class="math inline">\(-\rho\sigma_1\)</span> then add to second row etc. to eliminate off-diagonals on each row (minus first column)</p>
<p>Then proceed to multiply second column by <span class="math inline">\(\frac{\rho}{\sigma_1(1-\rho)}\)</span> and add to first column (eliminate off diagonals of first column)</p>
<p>Take product of diagonals</p>
</div>
</div>
<div id="the-inverse-of-the-compound-symmetric-covariance-matrix" class="section level1">
<h1>The inverse of the compound symmetric covariance matrix</h1>
<p><span class="math display">\[\begin{aligned}
\left(\begin{array}{cccc}
\sigma &amp; \rho &amp; \cdots &amp; \rho \\
\rho &amp; \sigma &amp; \cdots &amp; \rho \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho &amp; \rho &amp; \cdots &amp; \sigma
\end{array}\right)^{-1} &amp;=\left((\sigma-\rho) \mathbf{I}_{n}+\rho \mathbf{J}_{n}\right)^{-1} \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}+\frac{\rho}{\sigma-\rho} \mathbf{J}_{n}\right)^{-1} \\
&amp;=\frac{1}{\sigma-\rho} \sum_{i=0}^{\infty}(-1)^{i}\left(\frac{\rho}{\sigma-\rho} \mathbf{J}_{n}\right)^{i} \\
&amp;=\frac{1}{\sigma-\rho} \sum_{i=0}^{\infty}(-1)^{i}\left(\frac{\rho}{\sigma-\rho}\right)^{i} n^{i-1} \mathbf{J}_{n} \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}+\sum_{i=1}^{\infty}(-1)^{i}\left(\frac{\rho}{\sigma-\rho}\right)^{i} n^{i-1} \mathbf{J}_{n}\right) \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}-\frac{\rho}{\sigma-\rho} \sum_{i=1}^{\infty}(-1)^{i-1}\left(\frac{\rho}{\sigma-\rho}\right)^{i-1} n^{i-1} \mathbf{J}_{n}\right) \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}-\frac{\rho}{\sigma-\rho} \sum_{i=0}^{\infty}(-1)^{i}\left(\frac{\rho}{\sigma-\rho}\right)^{i} n^{i} \mathbf{J}_{n}\right) \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}-\frac{\rho}{\sigma-\rho} \frac{1}{1+\frac{n \rho}{\sigma-\rho}} \mathbf{J}_{n}\right) \\
 &amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}-\frac{\rho}{\sigma-\rho+n \rho} \mathbf{J}_{n}\right) \\
&amp;=\frac{1}{\sigma-\rho}\left(\mathbf{I}_{n}-\frac{\rho}{\sigma+(n-1) \rho} \mathbf{J}_{n}\right)
\end{aligned}\]</span></p>
</div>
<div id="full-likelihood-model" class="section level1">
<h1>Full likelihood model</h1>
<p>Consider trivariate normal:
<span class="math display">\[ Y=\left(\begin{array}{c}
Y_{1} \\
Y_{2} \\
Y_{3}
\end{array}\right) \sim N\left(\left(\begin{array}{c}
\mu_{1} \\
\mu_{2} \\
\mu_{3}
\end{array}\right), \quad \mathrm{V}\right)\\ \text { where } \mathrm{V}=\sigma^{2}\left(\begin{array}{ccc}
1 &amp; \rho &amp; \rho \\
\rho &amp; 1 &amp; \rho \\
\rho &amp; \rho &amp; 1
\end{array}\right)\]</span></p>
<div id="full-likelihood" class="section level2">
<h2>Full likelihood</h2>
<p><span class="math display">\[\begin{aligned}
-2ll &amp;=\log |V|+(Y-\mu)^{T} V^{-1}(Y-\mu) \\
 &amp;=\ln \left(\sigma^{2}(1+2 \rho)(1-\rho)^{2}\right)+\tilde{Y}^{T} \frac{1}{\sigma^{2}(1-\rho)}\left(\mathbf{I}_{3}-\frac{\rho}{1+2 \rho} \mathbf{J}_{3}\right) \tilde{Y} \\
 &amp;=\ln \left(\sigma^{2}(1+2 \rho)(1-\rho)^{2}\right)+\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{2}(1-\rho)}+\frac{1}{\sigma^{2}(1-\rho)} \frac{\rho}{1+2 \rho} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \\
 &amp;=\ln \left(\sigma^{2}\right)+\ln (1+2 \rho)+2 \ln (1-\rho)+\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{2}(1-\rho)}+\frac{\rho \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y}}{\sigma^{2}\left(1+\rho-2 \rho^{2}\right)} 
\end{aligned}\]</span>
where:</p>
<p><span class="math display">\[\begin{aligned} \det(V)&amp;=\sigma^{2} \det\left(\begin{array}{lll}
1 &amp; p &amp; p \\
\rho &amp; 1 &amp; \rho \\
\rho &amp; \rho &amp; 1
\end{array}\right)\\
&amp;=\sigma^{2}(1+2 \rho)(1-\rho)^{2} \end{aligned}\]</span></p>
<p><span class="math display">\[V^{-1}=\frac{1}{\sigma^{2}}\left(\begin{array}{ccc}
1 &amp; \rho &amp; \rho \\
\rho &amp; 1 &amp; \rho \\
\rho &amp; \rho &amp; 1
\end{array}\right)^{-1}\]</span>
<span class="math display">\[=\frac{1}{\sigma^{2}} \frac{1}{1-\rho}\left(I_{3}-\frac{\rho}{1+2 \rho} J_{3}\right)\]</span></p>
</div>
<div id="gradients" class="section level2">
<h2>Gradients</h2>
<p><span class="math display">\[\begin{aligned}\frac{\partial(-2 l l)}{\partial\left(\sigma^{2}\right)} &amp;=\frac{1}{\sigma^{2}}-\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{4}(1-\rho)}-\frac{\rho}{\sigma^{4}\left(1+\rho-2 \rho^{2}\right)} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \\
\frac{d(-2 l l)}{d \rho} &amp;=\frac{2}{1+2 \rho}-\frac{2}{1-\rho}-\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{2}(1-\rho)}+\frac{1+2 \rho^{2}}{\sigma^{2}\left(1+\rho-2 \rho^{2}\right)^{2}} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \end{aligned}\]</span></p>
</div>
<div id="hessians" class="section level2">
<h2>Hessians</h2>
<p><span class="math display">\[\begin{aligned}
\frac{d^{2}(-2 l l)}{d\left(\sigma^{2}\right)^{2}} &amp;=-\frac{1}{\sigma^{4}}+\frac{2 \tilde{Y}^{T} \tilde{Y}}{\sigma^{6}(1-\rho)}+\frac{2 \rho}{\sigma^{6}\left(1+\rho-2 \rho^{2}\right)} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \\
\frac{d^{2}(-2 l l)}{d\left(\sigma^{2}\right) d \rho} &amp;=\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{4}(1-\rho)^{2}}-\frac{1+2 \rho^{2}}{\sigma^{4}\left(1+\rho-2 \rho^{2}\right)^{2}} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \\
\frac{d^{2}(-2 l l)}{d \rho^{2}} &amp;=\frac{-4}{(1+2 \rho)^{2}}+\frac{2}{(1-\rho)^{2}}+\frac{\tilde{Y}^{T} \tilde{Y}}{\sigma^{2}(1-\rho)^{2}}+\frac{2\left(4 \rho^{3}+6 \rho-1\right)}{\sigma^{2}\left(1+\rho-2 \rho^{2}\right)^{3}} \tilde{Y}^{T} \mathbf{J}_{3} \tilde{Y} \end{aligned}\]</span></p>
<p><span class="math display">\[\operatorname{mle}\left(\sigma^{2}\right)=\widehat{\sigma^{2}}=\frac{2 \tilde{Y}^{T} \tilde{Y}}{1-\rho}+\frac{2 \rho \tilde{Y}^{T} J_{3} \tilde{Y}}{1+\rho-2 \rho^{2}}\]</span></p>
</div>
</div>
<div id="pairwise-model" class="section level1">
<h1>Pairwise model</h1>
<p>Let <span class="math display">\[\tilde{Y}_{i j}=\left(\begin{array}{l}Y_{i}-\mu_{i} \\ Y_{j}-\mu_{j}\end{array}\right),\]</span></p>
<p>and let</p>
<p><span class="math display">\[l l_{i j}\]</span> be the log-likelihood of <span class="math inline">\(\tilde{Y}_{i j}\)</span> then pairwise likelihood of <span class="math inline">\(\tilde{Y}\)</span> is
<span class="math display">\[l l_{p}=l l_{12}+l l_{13}+l l_{13} \]</span></p>
<div id="pairwise-likelihood" class="section level2">
<h2>pairwise likelihood</h2>
<p><span class="math display">\[\begin{aligned} -2 l l_{i j} &amp; =\log |V|+\widetilde{Y_{i j}}^{T} V^{-1} \widetilde{Y_{i j}} \\
&amp;=\ln \left(\sigma^{2}\left(1-\rho^{2}\right)\right)+\tilde{Y}_{ij}^{T} \frac{1}{\sigma^{2}(1-\rho)}\left(\mathbf{I}_{2}-\frac{\rho}{1+\rho} \mathbf{J}_{2}\right) \tilde{Y}_{i j} \\
&amp;=\ln \left(\sigma^{2}\right)+\ln (1+\rho)+\ln (1-\rho)+\frac{\tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{2}(1-\rho)}+\frac{\rho \widetilde{Y}_{i j}^{T} \mathbf{J}_{3} \widetilde{Y}_{i j}}{\sigma^{2}\left(1-\rho^{2}\right)} \end{aligned}\]</span>
<span class="math display">\[\begin{aligned}
\det\left(V_{12}\right)&amp;=\sigma^{2} \det\left(\begin{array}{cc}
1 &amp; \rho \\
\rho &amp; 1
\end{array}\right)\\
&amp;=\sigma^{2}\left(1-\rho^{2}\right)\end{aligned}\]</span>
where:
<span class="math display">\[ \begin{aligned}
V^{-1}&amp;=\frac{1}{\sigma^{2}}\left(\begin{array}{ccc}
1 &amp; \rho &amp; \rho \\
\rho &amp; 1 &amp; \rho \\
\rho &amp; \rho &amp; 1
\end{array}\right)^{-1}\\
&amp;=\frac{1}{\sigma^{2}} \frac{1}{1-\rho}\left(I_{2}-\frac{\rho}{1+\rho} J_{2}\right) \\
\end{aligned}\]</span></p>
</div>
<div id="gradients-1" class="section level2">
<h2>Gradients</h2>
<p><span class="math display">\[\begin{aligned}
\frac{d\left(-2 l l_{i j}\right)}{d\left(\sigma^{2}\right)}&amp;=\frac{1}{\sigma^{2}}-\frac{\tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{4}(1-\rho)}-\frac{\rho \widetilde{Y_{l}}^{T} \mathbf{J}_{3} \widetilde{Y}_{i j}}{\sigma^{4}\left(1-\rho^{2}\right)} \\
\frac{d\left(-2 l l_{i j}\right)}{d \rho}&amp;=\frac{1}{1+\rho}-\frac{1}{1-\rho}-\frac{\tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{2}(1-\rho)^{2}}+\frac{1+\rho^{2}}{\sigma^{2}\left(1-\rho^{2}\right)^{2}} \widetilde{Y_{i j}}^{T} \mathbf{J}_{3} \widetilde{Y_{ij}} \end{aligned}\]</span></p>
</div>
<div id="hessians-1" class="section level2">
<h2>Hessians</h2>
<p><span class="math display">\[\begin{aligned}
\frac{d^{2}\left(-2 l l_{i j}\right)}{d\left(\sigma^{2}\right)^{2}} &amp;=-\frac{1}{\sigma^{4}}+\frac{-2 \tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{6}(1-\rho)}+\frac{2 \rho \widetilde{Y}_{ij}^{T} \mathbf{J}_{3} \widetilde{Y}_{ij}}{\sigma^{6}\left(1-\rho^{2}\right)} \\
\frac{d^{2}\left(-2 l l_{i j}\right)}{d\left(\sigma^{2}\right) d \rho} &amp;=\frac{\tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{4}(1-\rho)^{2}}-2 \frac{1+\rho^{2}}{\sigma^{4}\left(1-\rho^{2}\right)^{2}} \widetilde{Y_{ij}}^{T} \mathbf{J}_{3} \widetilde{Y_{i j}} \\
\frac{d^{2}\left(-2 l l_{i j}\right)}{d \rho^{2}} &amp;=-\frac{1}{(1+\rho)^{2}}+\frac{1}{(1-\rho)^{2}}+\frac{2 \tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{\sigma^{2}(1-\rho)^{3}}+2 \frac{\rho-\rho^{3}+2 \rho^{4}}{\sigma^{2}\left(1-\rho^{2}\right)^{3}} \widetilde{Y}_{ij}^{T} \mathbf{J}_{3} \widetilde{Y_{ij}}
\end{aligned}\]</span></p>
<p><span class="math display">\[\begin{aligned}
\frac{d^{2}\left(-2 l l_{p}\right)}{d\left(\sigma^{2}\right)^{2}} &amp;=-\frac{3}{\sigma^{4}}+\frac{-2 A}{\sigma^{6}(1-\rho)}+\frac{2 \rho B}{\sigma^{6}\left(1-\rho^{2}\right)} \\
\frac{d^{2}\left(-2 l l_{p}\right)}{d\left(\sigma^{2}\right) d \rho}&amp;= \frac{A}{\sigma^{4}(1-\rho)^{2}}-2 \frac{1+\rho^{2}}{\sigma^{4}\left(1-\rho^{2}\right)^{2}} B \\
\frac{d^{2}\left(-2 l l_{p}\right)}{d \rho^{2}}&amp;=-\frac{3}{(1+\rho)^{2}}+\frac{3}{(1-\rho)^{2}}+\frac{2 A}{\sigma^{2}(1-\rho)^{3}}+2 \frac{\rho-\rho^{3}+2 \rho^{4}}{\sigma^{2}\left(1-\rho^{2}\right)^{3}} B \\
\end{aligned}\]</span></p>
<p>where:</p>
<p><span class="math display">\[\begin{aligned} A&amp;=\tilde{Y}_{12}^{\top} \tilde{Y}_{12}+\tilde{Y}_{13}^{\top} \tilde{Y}_{13}+\tilde{Y}_{23}^{\top} \tilde{Y}_{23} \\
 B&amp;=\tilde{Y}_{12}^{\top} \mathbf{J}_{2} \tilde{Y}_{12}+\tilde{Y}_{13}^{\top} \widetilde{\mathbf{J}}_{2} Y_{13}+\tilde{Y}_{23}^{\top} \mathbf{J}_{2} \tilde{Y}_{23}\end{aligned}\]</span></p>
<p><span class="math display">\[m l e\left(\sigma^{2}\right)_{p a i r w i s e}=\sigma^{2}=\frac{-2 \tilde{Y}_{i j}^{T} \tilde{Y}_{i j}}{(1-\rho)}+\frac{2 \rho \widetilde{Y_{ij}}^T \mathbf{J}_{3} \widetilde{Y_{ij}}}{(1-p)(1+p)}\]</span></p>
</div>
</div>
